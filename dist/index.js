function n(n){return null}function e(n){return null}function t(n){return null}function r(n){return null}function i(){return{run:function(n){return n}}}var o,u,a={},s={},f=-1;function d(n,e){a[n]=e}function c(n){if(n in a)throw"node ".concat(n," already defined");return a[n]=++f,s[f]=n,f}function l(n){if(n in a)return a[n];throw"node ".concat(n," not defined")}function p(n){for(;;){if("function"!=typeof n.type)throw"non functional component";if(n.type==e)break;if("object"!=typeof(n=n.type.call(null,n.props)))throw"non react element"}return n}function g(e,i){for(var o=e.props,u=e.props.children,a=i+"."+o.name,s=o.params,f=[],v=0,h=u;v<h.length;v++){var O=h[v];if(O.type==t)for(var b=(m=O.props).params,y=0;y<b.length;++y){var N=l(i+"."+s[y]);d(a+"."+b[y],N)}else if(O.type==r){var m;d(a+"."+(w=(m=O.props).name),B=l(a+"."+m.dep))}else if(O.type==n){var D=O.props,w=D.name,k=D.deps,F=[];if(k&&k.length)for(var I=0,S=k;I<S.length;I++){var x=l(a+"."+S[I]);F.push(x)}var B=c(a+"."+w);f.push({id:B,deps:F,gen:D.gen})}else{var R=p(O);f=f.concat(g(R,a))}}return f}function v(e,o){void 0===o&&(o=!1);for(var u="",v=[],h={},O=[],b=0,y=p(e).props.children;b<y.length;b++){var N=y[b];if(N.type==t)for(var m=0,D=(k=N.props).params;m<D.length;m++){var w=c("."+D[m]);v.push({id:w,deps:[],gen:i})}else if(N.type==r){d("."+(F=(k=N.props).name),w=l("."+k.dep)),h[w]=F}else if(N.type==n){var k,F=(k=N.props).name,I=k.deps,S=[];if(I&&I.length)for(var x=0,B=I;x<B.length;x++){var R=l("."+B[x]);S.push(R)}w=c("."+F);O.push({id:w,deps:S,gen:k.gen})}else{var j=p(N);O=O.concat(g(j,u))}}a={},f=-1;var C=function(){var n=[],e=[],t={},r=[],i={},o=void 0,u={build:function(){return r.sort((function(n,e){return n.id>e.id?1:-1})),{inputs:n,outputs:t,nodes:r,binding:i,zeroDepNodes:e,nodeNames:o}},input:function(e){r=r.concat(e);for(var t=0,i=e;t<i.length;t++){var o=i[t];n.push(o.id)}return u},output:function(n){return t=n,u},next:function(n){for(var t=0,o=n;t<o.length;t++){var a=o[t];0==a.deps.length&&e.push(a.id);for(var s=0,f=a.deps;s<f.length;s++){var d=f[s];d in i?i[d].push(a.id):i[d]=[a.id]}}return r=r.concat(n),u},nodeNames:function(n){return o=n,u}};return u}();return C.input(v).next(O).output(h),o&&C.nodeNames(Object.assign({},s)),s={},C.build()}function h(n,e,t){if(2==n[e])return!0;if(1==n[e])return!1;if(n[e]=1,e in t.binding)for(var r=0,i=t.binding[e];r<i.length;r++){if(!h(n,i[r],t))return!1}return n[e]=2,!0}function O(n){return"{id:"+n.id+",deps:"+JSON.stringify(n.deps)+",gen:"+n.gen.name+"},"}function b(n){var e="{";e+="inputs:".concat(JSON.stringify(n.inputs),","),e+="zeroDepNodes:".concat(JSON.stringify(n.zeroDepNodes),","),e+="nodes:[";for(var t=0,r=n.nodes;t<r.length;t++){e+=O(r[t])}for(var i in e+="],",e+="outputs:{",n.outputs)e+=i+":"+JSON.stringify(n.outputs[i])+",";for(var i in e+="},",e+="binding:{",n.binding)e+=i+":"+JSON.stringify(n.binding[i])+",";return e+="},",e+="}"}function y(n){var e=n.nodes.length;if(e<=0)return o.EmptyWorkflow;for(var t=0;t<e;++t)if(n.nodes[t].id!=t)return o.NodesDisorder;for(var r=0,i=n.inputs;r<i.length;r++){var u=i[r];if(u<0||u>=n.nodes.length)return o.InputOutOfNodes}for(var a=0,s=n.zeroDepNodes;a<s.length;a++){var f=s[a];if(f<0||f>=n.nodes.length)return o.ZeroDepOutOfNodes}for(var d=0,c=Object.keys(n.outputs);d<c.length;d++){var l=c[d],p=parseInt(l);if(p<0||p>=e)return o.OutputOutOfNodes}for(var g in n.binding){var v=parseInt(g);if(v<0||v>=e)return o.BindingOutOfNodes;for(var O=0,b=n.binding[v];O<b.length;O++){if((I=b[O])<0||I>=e)return o.BindingOutOfNodes}}for(var y=0,N=n.nodes;y<N.length;y++){if((R=N[y]).deps.length)for(var m=0,D=R.deps;m<D.length;m++){if(!(D[m]in n.binding))return o.DepNotFoundInBinding}}for(var g in n.binding)for(var w=parseInt(g),k=0,F=n.binding[w];k<F.length;k++){var I=F[k];if(n.nodes[I].deps.indexOf(w)<0)return o.BindingNotFoundInDep}for(var S=Array(e).fill(0),x=0,B=n.nodes;x<B.length;x++){var R;if(!h(S,(R=B[x]).id,n))return o.CircularDetected}return o.OK}function N(n,e,t,r){return new(t||(t=Promise))((function(i,o){function u(n){try{s(r.next(n))}catch(n){o(n)}}function a(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(u,a)}s((r=r.apply(n,e||[])).next())}))}function m(n,e){var t,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(n,u)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function D(n){var e=n,t=0,r=u.NotStarted,i={},o={},a=[],s=[];function f(n,t){if(l(n,u.Done),void 0===t)return[];var r=t;"object"==typeof t&&(r=Object.freeze(r)),n in e.outputs&&(o[e.outputs[n]]=r);var a=[],s=e.binding[n];if(s&&s.length)for(var f=0,d=s;f<d.length;f++){var c=d[f];c in i||(i[c]={}),i[c][n]=r;var p=e.nodes[c];if(Object.keys(i[c]).length==p.deps.length){for(var g=[],v=0,h=p.deps;v<h.length;v++){var O=h[v];g.push(i[c][O])}var b={node:p.gen(),id:p.id,inputs:g};delete i[c],a.push(b)}}return a}var d=!1,c=[];function l(n,t){if(d)if(t==u.Running)c.push({id:n,start:(new Date).getTime(),end:0,status:t,name:e.nodeNames&&n in e.nodeNames?e.nodeNames[n]:void 0});else for(var r=c.length-1;r>=0;r--)if(c[r].id==n){c[r].status=t,c[r].end=(new Date).getTime();break}}var p={state:function(){return r},inst:function(n){d=n},stats:function(){return c},workflow:function(){return n},reset:function(){r=u.NotStarted,i={},o={},a=[],s=[],c=[]},setTimeout:function(n){t=n},cancel:function(){if(r==u.Running){r=u.Cancelled;for(var n=0,e=a;n<e.length;n++){var t=e[n];t.node.cancel&&(l(t.id,u.Cancelled),t.node.cancel())}}},run:function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return N(this,void 0,void 0,(function(){function i(n){var e=this;return new Promise((function(t,o){return N(e,void 0,void 0,(function(){var e,o,d=this;return m(this,(function(c){switch(c.label){case 0:for(e=function(){var e,t=n.pop(),o=void 0;try{l(t.id,u.Running),o=(e=t.node).run.apply(e,t.inputs)}catch(n){return p.cancel(),r=u.Failure,l(t.id,u.Failure),o=void 0,"break"}if(o instanceof Promise){a.push(t);var c=o.then((function(n){return N(d,void 0,void 0,(function(){var e,o;return m(this,(function(d){return r!=u.Running||((e=a.indexOf(t))>=0&&a.splice(e,1),(o=f.call(p,t.id,n)).length&&s.push(i(o))),[2]}))}))})).catch((function(){p.cancel(),r=u.Failure,l(t.id,u.Failure),o=void 0}));s.push(c)}else{var g=f.call(p,t.id,o);n=n.concat(g)}};n.length&&"break"!==e(););c.label=1;case 1:return s.length>0?(o=s.splice(0,s.length),[4,Promise.all(o)]):[3,3];case 2:return c.sent(),[3,1];case 3:return t(!0),[2]}}))}))}))}var d,c,g,v,h;return m(this,(function(a){switch(a.label){case 0:for(t>0&&setTimeout((function(){r==u.Running&&p.cancel()}),t),r=u.Running,d=[],c=0;c<n.length;++c)d.push({node:e.nodes[e.inputs[c]].gen(),id:e.inputs[c],inputs:[n[c]]});for(g=0,v=e.zeroDepNodes;g<v.length;g++)h=v[g],d.push({node:e.nodes[h].gen(),id:h,inputs:[]});return[4,i(d)];case 1:return a.sent(),r==u.Running&&(r=Object.keys(e.outputs).length==Object.keys(o).length?u.Done:u.Failure),[2,o]}}))}))}};return p}!function(n){n[n.OK=0]="OK",n[n.EmptyWorkflow=1]="EmptyWorkflow",n[n.NodesDisorder=2]="NodesDisorder",n[n.InputOutOfNodes=3]="InputOutOfNodes",n[n.ZeroDepOutOfNodes=4]="ZeroDepOutOfNodes",n[n.OutputOutOfNodes=5]="OutputOutOfNodes",n[n.BindingOutOfNodes=6]="BindingOutOfNodes",n[n.DepNotFoundInBinding=7]="DepNotFoundInBinding",n[n.BindingNotFoundInDep=8]="BindingNotFoundInDep",n[n.CircularDetected=9]="CircularDetected"}(o||(o={})),function(n){n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Cancelled=2]="Cancelled",n[n.Failure=3]="Failure",n[n.Done=4]="Done"}(u||(u={}));export{u as ExecutionStatus,t as InputNodeComponent,n as NodeComponent,r as OutputNodeComponent,e as WorkflowComponent,o as WorkflowValidationStatus,v as buildJsxWorkflow,D as createWorkflowExecutor,b as dumpWorkflow,i as unitNodeGenerator,y as validateWorkflow};
