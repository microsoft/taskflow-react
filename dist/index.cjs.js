"use strict";function t(t){return null}function n(t){return null}function e(t){return null}function r(t){return null}function o(){return{run:function(t){return t}}}Object.defineProperty(exports,"__esModule",{value:!0});var i,u,a={},s={},f=-1;function d(t,n){a[t]=n}function p(t){if(t in a)throw"node ".concat(t," already defined");return a[t]=++f,s[f]=t,f}function l(t){if(t in a)return a[t];throw"node ".concat(t," not defined")}function c(t){for(;;){if("function"!=typeof t.type)throw"non functional component";if(t.type==n)break;if("object"!=typeof(t=t.type.call(null,t.props)))throw"non react element"}return t}function v(n,o){for(var i=n.props,u=n.props.children,a=o+"."+i.name,s=i.params,f=[],g=0,h=u;g<h.length;g++){var x=h[g];if(x.type==e)for(var N=(b=x.props).params,O=0;O<N.length;++O){var S=l(o+"."+s[O]);d(a+"."+N[O],S)}else if(x.type==r){var b;d(a+"."+(w=(b=x.props).name),V=l(a+"."+b.dep))}else if(x.type==t){var y=x.props,w=y.name,m=y.deps,k=[];if(m&&m.length)for(var D=0,E=m;D<E.length;D++){var W=l(a+"."+E[D]);k.push(W)}var V=p(a+"."+w);f.push({id:V,deps:k,gen:y.gen})}else{var F=c(x);f=f.concat(v(F,a))}}return f}function g(t,n,e){if(2==t[n])return!0;if(1==t[n])return!1;if(t[n]=1,n in e.binding)for(var r=0,o=e.binding[n];r<o.length;r++){if(!g(t,o[r],e))return!1}return t[n]=2,!0}function h(t){return"{id:"+t.id+",deps:"+JSON.stringify(t.deps)+",gen:"+t.gen.name+"},"}function x(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{s(r.next(t))}catch(t){i(t)}}function a(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}s((r=r.apply(t,n||[])).next())}))}function N(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}exports.WorkflowValidationStatus=void 0,(i=exports.WorkflowValidationStatus||(exports.WorkflowValidationStatus={}))[i.OK=0]="OK",i[i.EmptyWorkflow=1]="EmptyWorkflow",i[i.NodesDisorder=2]="NodesDisorder",i[i.InputOutOfNodes=3]="InputOutOfNodes",i[i.ZeroDepOutOfNodes=4]="ZeroDepOutOfNodes",i[i.OutputOutOfNodes=5]="OutputOutOfNodes",i[i.BindingOutOfNodes=6]="BindingOutOfNodes",i[i.DepNotFoundInBinding=7]="DepNotFoundInBinding",i[i.BindingNotFoundInDep=8]="BindingNotFoundInDep",i[i.CircularDetected=9]="CircularDetected",exports.ExecutionStatus=void 0,(u=exports.ExecutionStatus||(exports.ExecutionStatus={}))[u.NotStarted=0]="NotStarted",u[u.Running=1]="Running",u[u.Cancelled=2]="Cancelled",u[u.Failure=3]="Failure",u[u.Done=4]="Done",exports.InputNodeComponent=e,exports.NodeComponent=t,exports.OutputNodeComponent=r,exports.WorkflowComponent=n,exports.buildJsxWorkflow=function(n,i){void 0===i&&(i=!1);for(var u="",g=[],h={},x=[],N=0,O=c(n).props.children;N<O.length;N++){var S=O[N];if(S.type==e)for(var b=0,y=(m=S.props).params;b<y.length;b++){var w=p("."+y[b]);g.push({id:w,deps:[],gen:o})}else if(S.type==r){d("."+(k=(m=S.props).name),w=l("."+m.dep)),h[w]=k}else if(S.type==t){var m,k=(m=S.props).name,D=m.deps,E=[];if(D&&D.length)for(var W=0,V=D;W<V.length;W++){var F=l("."+V[W]);E.push(F)}w=p("."+k);x.push({id:w,deps:E,gen:m.gen})}else{var I=c(S);x=x.concat(v(I,u))}}a={},f=-1;var C=function(){var t=[],n=[],e={},r=[],o={},i=void 0,u={build:function(){return r.sort((function(t,n){return t.id>n.id?1:-1})),{inputs:t,outputs:e,nodes:r,binding:o,zeroDepNodes:n,nodeNames:i}},input:function(n){r=r.concat(n);for(var e=0,o=n;e<o.length;e++){var i=o[e];t.push(i.id)}return u},output:function(t){return e=t,u},next:function(t){for(var e=0,i=t;e<i.length;e++){var a=i[e];0==a.deps.length&&n.push(a.id);for(var s=0,f=a.deps;s<f.length;s++){var d=f[s];d in o?o[d].push(a.id):o[d]=[a.id]}}return r=r.concat(t),u},nodeNames:function(t){return i=t,u}};return u}();return C.input(g).next(x).output(h),i&&C.nodeNames(Object.assign({},s)),s={},C.build()},exports.createWorkflowExecutor=function(t){var n=t,e=0,r=exports.ExecutionStatus.NotStarted,o={},i={},u=[],a=[];function s(t,e){if(p(t,exports.ExecutionStatus.Done),void 0===e)return[];var r=e;"object"==typeof e&&(r=Object.freeze(r)),t in n.outputs&&(i[n.outputs[t]]=r);var u=[],a=n.binding[t];if(a&&a.length)for(var s=0,f=a;s<f.length;s++){var d=f[s];d in o||(o[d]={}),o[d][t]=r;var l=n.nodes[d];if(Object.keys(o[d]).length==l.deps.length){for(var c=[],v=0,g=l.deps;v<g.length;v++){var h=g[v];c.push(o[d][h])}var x={node:l.gen(),id:l.id,inputs:c};delete o[d],u.push(x)}}return u}var f=!1,d=[];function p(t,e){if(f)if(e==exports.ExecutionStatus.Running)d.push({id:t,start:(new Date).getTime(),end:0,status:e,name:n.nodeNames&&t in n.nodeNames?n.nodeNames[t]:void 0});else for(var r=d.length-1;r>=0;r--)if(d[r].id==t){d[r].status=e,d[r].end=(new Date).getTime();break}}var l={state:function(){return r},inst:function(t){f=t},stats:function(){return d},workflow:function(){return t},reset:function(){r=exports.ExecutionStatus.NotStarted,o={},i={},u=[],a=[],d=[]},setTimeout:function(t){e=t},cancel:function(){if(r==exports.ExecutionStatus.Running){r=exports.ExecutionStatus.Cancelled;for(var t=0,n=u;t<n.length;t++){var e=n[t];e.node.cancel&&(p(e.id,exports.ExecutionStatus.Cancelled),e.node.cancel())}}},run:function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return x(this,void 0,void 0,(function(){function o(t){var n=this;return new Promise((function(e,i){return x(n,void 0,void 0,(function(){var n,i,f=this;return N(this,(function(d){switch(d.label){case 0:for(n=function(){var n,e=t.pop(),i=void 0;try{p(e.id,exports.ExecutionStatus.Running),i=(n=e.node).run.apply(n,e.inputs)}catch(t){return l.cancel(),r=exports.ExecutionStatus.Failure,p(e.id,exports.ExecutionStatus.Failure),i=void 0,"break"}if(i instanceof Promise){u.push(e);var d=i.then((function(t){return x(f,void 0,void 0,(function(){var n,i;return N(this,(function(f){return r!=exports.ExecutionStatus.Running||((n=u.indexOf(e))>=0&&u.splice(n,1),(i=s.call(l,e.id,t)).length&&a.push(o(i))),[2]}))}))})).catch((function(){l.cancel(),r=exports.ExecutionStatus.Failure,p(e.id,exports.ExecutionStatus.Failure),i=void 0}));a.push(d)}else{var c=s.call(l,e.id,i);t=t.concat(c)}};t.length&&"break"!==n(););d.label=1;case 1:return a.length>0?(i=a.splice(0,a.length),[4,Promise.all(i)]):[3,3];case 2:return d.sent(),[3,1];case 3:return e(!0),[2]}}))}))}))}var f,d,c,v,g;return N(this,(function(u){switch(u.label){case 0:for(e>0&&setTimeout((function(){r==exports.ExecutionStatus.Running&&l.cancel()}),e),r=exports.ExecutionStatus.Running,f=[],d=0;d<t.length;++d)f.push({node:n.nodes[n.inputs[d]].gen(),id:n.inputs[d],inputs:[t[d]]});for(c=0,v=n.zeroDepNodes;c<v.length;c++)g=v[c],f.push({node:n.nodes[g].gen(),id:g,inputs:[]});return[4,o(f)];case 1:return u.sent(),r==exports.ExecutionStatus.Running&&(r=Object.keys(n.outputs).length==Object.keys(i).length?exports.ExecutionStatus.Done:exports.ExecutionStatus.Failure),[2,i]}}))}))}};return l},exports.dumpWorkflow=function(t){var n="{";n+="inputs:".concat(JSON.stringify(t.inputs),","),n+="zeroDepNodes:".concat(JSON.stringify(t.zeroDepNodes),","),n+="nodes:[";for(var e=0,r=t.nodes;e<r.length;e++){n+=h(r[e])}for(var o in n+="],",n+="outputs:{",t.outputs)n+=o+":"+JSON.stringify(t.outputs[o])+",";for(var o in n+="},",n+="binding:{",t.binding)n+=o+":"+JSON.stringify(t.binding[o])+",";if(n+="},",t.nodeNames){for(var o in n+="nodeNames:{",t.nodeNames)n+=o+":"+JSON.stringify(t.nodeNames[o])+",";n+="},"}return n+="}"},exports.unitNodeGenerator=o,exports.validateWorkflow=function(t){var n=t.nodes.length;if(n<=0)return exports.WorkflowValidationStatus.EmptyWorkflow;for(var e=0;e<n;++e)if(t.nodes[e].id!=e)return exports.WorkflowValidationStatus.NodesDisorder;for(var r=0,o=t.inputs;r<o.length;r++){var i=o[r];if(i<0||i>=t.nodes.length)return exports.WorkflowValidationStatus.InputOutOfNodes}for(var u=0,a=t.zeroDepNodes;u<a.length;u++){var s=a[u];if(s<0||s>=t.nodes.length)return exports.WorkflowValidationStatus.ZeroDepOutOfNodes}for(var f=0,d=Object.keys(t.outputs);f<d.length;f++){var p=d[f],l=parseInt(p);if(l<0||l>=n)return exports.WorkflowValidationStatus.OutputOutOfNodes}for(var c in t.binding){var v=parseInt(c);if(v<0||v>=n)return exports.WorkflowValidationStatus.BindingOutOfNodes;for(var h=0,x=t.binding[v];h<x.length;h++){if((k=x[h])<0||k>=n)return exports.WorkflowValidationStatus.BindingOutOfNodes}}for(var N=0,O=t.nodes;N<O.length;N++){if((V=O[N]).deps.length)for(var S=0,b=V.deps;S<b.length;S++){if(!(b[S]in t.binding))return exports.WorkflowValidationStatus.DepNotFoundInBinding}}for(var c in t.binding)for(var y=parseInt(c),w=0,m=t.binding[y];w<m.length;w++){var k=m[w];if(t.nodes[k].deps.indexOf(y)<0)return exports.WorkflowValidationStatus.BindingNotFoundInDep}for(var D=Array(n).fill(0),E=0,W=t.nodes;E<W.length;E++){var V;if(!g(D,(V=W[E]).id,t))return exports.WorkflowValidationStatus.CircularDetected}return exports.WorkflowValidationStatus.OK};
