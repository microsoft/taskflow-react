#!/usr/bin/env node
"use strict";var o=require("commander"),r=require("path"),e=require("fs"),n=require("child_process");o.program.option("-w, --workflow <type>","relative path to workflow file"),o.program.option("-n, --name <type>","workflow name to compile in the file"),o.program.parse(process.argv);var c=o.program.opts();if(c.workflow&&c.name){e.rmSync(r.resolve("tsconfig.workflow_build.json"),{force:!0,recursive:!0}),e.rmSync(r.resolve("dump_workflow_script.ts"),{force:!0,recursive:!0}),e.rmSync(r.resolve("./_workflow_compile_"),{force:!0,recursive:!0});var l=c.workflow.substring(0,c.workflow.lastIndexOf(".")),s='\nimport { buildJsxWorkflow } from "taskflow-react"\nimport { dumpWorkflow } from "taskflow-react"\nimport {'.concat(c.name,'} from "').concat(l,'"\nconst workflow = buildJsxWorkflow(').concat(c.name,")\nexport const dumpWorkflowText = dumpWorkflow(workflow)\n");e.writeFileSync(r.resolve("./".concat("tsconfig.workflow_build.json")),'{\n    "compilerOptions": {\n      "target": "es5",\n      "module": "CommonJS",\n      "outDir": "_workflow_compile_",\n      "lib": ["ESNext", "dom"],\n      "allowJs": false,\n      "sourceMap": true,\n      "experimentalDecorators": false,\n      "noUnusedLocals": false,\n      "esModuleInterop": true,\n      "moduleResolution": "node",\n      "types": [\n        "node",\n        "jest",\n      ],\n      "jsx": "react"\n    }\n  }\n'),e.writeFileSync(r.resolve("./".concat("dump_workflow_script.ts")),s),n.exec("tsc --project ".concat("tsconfig.workflow_build.json"),(function(o,n,c){if(o)return console.error("exec error: ".concat(o)),console.log("stdout: ".concat(n)),void console.error("stderr: ".concat(c));var l=require("../../../_workflow_compile_/dump_workflow_script");console.log("[32m",l.dumpWorkflowText),console.log("[37m"),e.rmSync(r.resolve("tsconfig.workflow_build.json"),{force:!0,recursive:!0}),e.rmSync(r.resolve("dump_workflow_script.ts"),{force:!0,recursive:!0}),e.rmSync(r.resolve("./_workflow_compile_"),{force:!0,recursive:!0})}))}
